services:
  cinny:
    image: ghcr.io/cinnyapp/cinny:latest
    container_name: cinny
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: 10m
        max-file: 3
    configs:
      - source: cinny-config
        target: /app/config.json
    environment:
      VIRTUAL_PORT: ${VIRTUAL_PORT:-80}
      VIRTUAL_HOST: ${VIRTUAL_HOST}
      LETSENCRYPT_HOST: ${LETSENCRYPT_HOST}
      LETSENCRYPT_EMAIL: ${LETSENCRYPT_EMAIL}
    networks:
      - letsencrypt-network
configs:
  cinny-config:
    content: |-
      {
        "defaultHomeserver": 0,
        "homeserverList": [
          "${MATRIX_DOMAIN}"
        ],
        "allowCustomHomeservers": true,
        "featuredCommunities": {
          "openAsDefault": false,
          "spaces": [],
          "rooms": [],
          "servers": ["mozilla.org"]
        },

        "hashRouter": {
          "enabled": false,
          "basename": "/"
        }
      }
networks:
  letsencrypt-network:
    external: true
